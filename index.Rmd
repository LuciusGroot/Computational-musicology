---
title: "4'33''"
author: "Lucius Groot"
date: "2024-02-21"
output: 
  flexdashboard::flex_dashboard:
    storyboard: true
    theme: cosmo
    

---

```{r}
#Library
library(tidyverse)
library(spotifyr)
library(compmus)
library(purrr)
library(dplyr)
library(purrr)
library(tidymodels)
library(ggdendro)
library(heatmaply)

#circshift
circshift <- function(v, n) {
  if (n == 0) v else c(tail(v, n), head(v, -n))
}
#      C     C#    D     Eb    E     F     F#    G     Ab    A     Bb    B
major_chord <-
  c(   1,    0,    0,    0,    1,    0,    0,    1,    0,    0,    0,    0)
minor_chord <-
  c(   1,    0,    0,    1,    0,    0,    0,    1,    0,    0,    0,    0)
seventh_chord <-
  c(   1,    0,    0,    0,    1,    0,    0,    1,    0,    0,    1,    0)
major_key <-
  c(6.35, 2.23, 3.48, 2.33, 4.38, 4.09, 2.52, 5.19, 2.39, 3.66, 2.29, 2.88)
minor_key <-
  c(6.33, 2.68, 3.52, 5.38, 2.60, 3.53, 2.54, 4.75, 3.98, 2.69, 3.34, 3.17)

#Chord_template
chord_templates <-
  tribble(
    ~name, ~template,
    "Gb:7", circshift(seventh_chord, 6),
    "Gb:maj", circshift(major_chord, 6),
    "Bb:min", circshift(minor_chord, 10),
    "Db:maj", circshift(major_chord, 1),
    "F:min", circshift(minor_chord, 5),
    "Ab:7", circshift(seventh_chord, 8),
    "Ab:maj", circshift(major_chord, 8),
    "C:min", circshift(minor_chord, 0),
    "Eb:7", circshift(seventh_chord, 3),
    "Eb:maj", circshift(major_chord, 3),
    "G:min", circshift(minor_chord, 7),
    "Bb:7", circshift(seventh_chord, 10),
    "Bb:maj", circshift(major_chord, 10),
    "D:min", circshift(minor_chord, 2),
    "F:7", circshift(seventh_chord, 5),
    "F:maj", circshift(major_chord, 5),
    "A:min", circshift(minor_chord, 9),
    "C:7", circshift(seventh_chord, 0),
    "C:maj", circshift(major_chord, 0),
    "E:min", circshift(minor_chord, 4),
    "G:7", circshift(seventh_chord, 7),
    "G:maj", circshift(major_chord, 7),
    "B:min", circshift(minor_chord, 11),
    "D:7", circshift(seventh_chord, 2),
    "D:maj", circshift(major_chord, 2),
    "F#:min", circshift(minor_chord, 6),
    "A:7", circshift(seventh_chord, 9),
    "A:maj", circshift(major_chord, 9),
    "C#:min", circshift(minor_chord, 1),
    "E:7", circshift(seventh_chord, 4),
    "E:maj", circshift(major_chord, 4),
    "G#:min", circshift(minor_chord, 8),
    "B:7", circshift(seventh_chord, 11),
    "B:maj", circshift(major_chord, 11),
    "D#:min", circshift(minor_chord, 3)
  )

#key_template
key_templates <-
  tribble(
    ~name, ~template,
    "Gb:maj", circshift(major_key, 6),
    "Bb:min", circshift(minor_key, 10),
    "Db:maj", circshift(major_key, 1),
    "F:min", circshift(minor_key, 5),
    "Ab:maj", circshift(major_key, 8),
    "C:min", circshift(minor_key, 0),
    "Eb:maj", circshift(major_key, 3),
    "G:min", circshift(minor_key, 7),
    "Bb:maj", circshift(major_key, 10),
    "D:min", circshift(minor_key, 2),
    "F:maj", circshift(major_key, 5),
    "A:min", circshift(minor_key, 9),
    "C:maj", circshift(major_key, 0),
    "E:min", circshift(minor_key, 4),
    "G:maj", circshift(major_key, 7),
    "B:min", circshift(minor_key, 11),
    "D:maj", circshift(major_key, 2),
    "F#:min", circshift(minor_key, 6),
    "A:maj", circshift(major_key, 9),
    "C#:min", circshift(minor_key, 1),
    "E:maj", circshift(major_key, 4),
    "G#:min", circshift(minor_key, 8),
    "B:maj", circshift(major_key, 11),
    "D#:min", circshift(minor_key, 3)
  )
```


```{r}
###Shortcuts for the playlists:
  #433corpus_complete! 
aic <- get_playlist_audio_features("", "3ItGc1nDDikyt9X1MgYwGi") 
 #433corpus_made_and_performed_by_johncage
mapbjc <- get_playlist_audio_features("", "5sWJTo3Zxy9oTf5CCqc624") 
 #433corpus_not_made_or_performed_by_johncage 
nmopbjc <- get_playlist_audio_features("", "7qwMKRYgTiRLOLszqDYyj9") 
 #433corpus_made_by_johncage_but_not_performed
mbjcbnp <- get_playlist_audio_features("", "383bBCxqKWd8tpvWrU9yYH") 
 #433corpus_with_the_exact_length
cwtel <- get_playlist_audio_features("", "7uZC9eTFcWrVxQIHhy45IE")

#shortcut for the 3 playlists (basically the same as 'aic'):
sc <-
  bind_rows(
    mapbjc |> mutate(category = "Made and performed"),
    nmopbjc |> mutate(category = "Covers/Interpretation without credits to John Cage"),
    mbjcbnp |> mutate(category = "Made but not performed by John Cage")
  )

###week 12 code behind the scene:
corpus433complete <-
  get_playlist_audio_features("433corpus_complete", "3ItGc1nDDikyt9X1MgYwGi") |>
  add_audio_analysis() |>
  mutate(
    segments = map2(segments, key, compmus_c_transpose),
    pitches =
      map(segments,
        compmus_summarise, pitches,
        method = "mean", norm = "manhattan"
      ),
    timbre =
      map(
        segments,
        compmus_summarise, timbre,
        method = "mean"
      )
  ) |>
  mutate(pitches = map(pitches, compmus_normalise, "clr")) |>
  mutate_at(vars(pitches, timbre), map, bind_rows) |>
  unnest(cols = c(pitches, timbre))

###ALLES HIERONDER NOG SORTEREN/OPRUIMEN!!!

# Define the function to create a mapbjc track
create_mapbjc_track <- function(track_id) {
  track_data <- get_tidy_audio_analysis(track_id)
  
  matched_pitch_data <- track_data %>%
    compmus_align(bars, segments) %>%
    mutate(
      pitches = map(segments, compmus_summarise, pitches, method = "mean", norm = "manhattan")
    ) %>%
    compmus_match_pitch_template(chord_templates, "euclidean", "manhattan")
  
  return(matched_pitch_data)
}

# List of track IDs
track_ids <- c("2bNCdW4rLnCTzgqUXTTDO1", "5B7HHrAsopOgp3wjP0PMgT", "4F76YbFSTzXboAKhyypE7a", "0AQRAsPtKDHCv369ktkp3x", "3jb5L9viOhEoYuVbfpvlhA", "4JRtsjsSqunh2ILro1EAhH", "0EOT1qmisxEi2MDJ6DaWHT", "0eBgJxMleTWezJZPciCqdO", "52QLogPTXh3KJI7JwjG2vP", "0EOT1qmisxEi2MDJ6DaWHT" )


# Assume you have chord_templates defined as shown in a previous conversation

# Define the function to create a mapbjc track


create_mapbjc_track <- function(track_id) {
  track_data <- get_tidy_audio_analysis(track_id)
  
  aligned_data <- track_data |>
    compmus_align(bars, segments) |>
    select(bars) |>
    unnest(bars) |>
    mutate(
      pitches =
        map(segments,
          compmus_summarise, pitches,
          method = "rms", norm = "euclidean"
        ),
      timbre =
        map(segments,
          compmus_summarise, timbre,
          method = "rms", norm = "euclidean"
        )
    )
  
  return(aligned_data)
}


# List of track IDs
track_ids <- c("2bNCdW4rLnCTzgqUXTTDO1", "5B7HHrAsopOgp3wjP0PMgT", "4F76YbFSTzXboAKhyypE7a", "0AQRAsPtKDHCv369ktkp3x", "3jb5L9viOhEoYuVbfpvlhA", "4JRtsjsSqunh2ILro1EAhH", "0EOT1qmisxEi2MDJ6DaWHT", "0eBgJxMleTWezJZPciCqdO", "52QLogPTXh3KJI7JwjG2vP", "0EOT1qmisxEi2MDJ6DaWHT")

# Example usage:
mapbjc1 <- create_mapbjc_track("2bNCdW4rLnCTzgqUXTTDO1")
mapbjc2 <- create_mapbjc_track("5B7HHrAsopOgp3wjP0PMgT")
mapbjc3 <- create_mapbjc_track("4F76YbFSTzXboAKhyypE7a")
mapbjc4 <- create_mapbjc_track("0AQRAsPtKDHCv369ktkp3x")
mapbjc5 <- create_mapbjc_track("3jb5L9viOhEoYuVbfpvlhA")
mapbjc6 <- create_mapbjc_track("4JRtsjsSqunh2ILro1EAhH")
mapbjc7 <- create_mapbjc_track("0EOT1qmisxEi2MDJ6DaWHT")
mapbjc10 <- create_mapbjc_track("18KH1UVb7HMWaesDkTsyhS")

#confusion matrix, i do not have to do this
get_conf_mat <- function(fit) {
  outcome <- .get_tune_outcome_names(fit)
  fit |> 
    collect_predictions() |> 
    conf_mat(truth = outcome, estimate = .pred_class)
}  
get_pr <- function(fit) {
  fit |> 
    conf_mat_resampled() |> 
    group_by(Prediction) |> mutate(precision = Freq / sum(Freq)) |> 
    group_by(Truth) |> mutate(recall = Freq / sum(Freq)) |> 
    ungroup() |> filter(Prediction == Truth) |> 
    select(class = Prediction, precision, recall)
}  
```


```{r}
### week 12
corpus433complete <-
  get_playlist_audio_features("bnfcollection", "3ItGc1nDDikyt9X1MgYwGi") |>
  add_audio_analysis() |>
  mutate(
    segments = map2(segments, key, compmus_c_transpose),
    pitches =
      map(segments,
        compmus_summarise, pitches,
        method = "mean", norm = "manhattan"
      ),
    timbre =
      map(
        segments,
        compmus_summarise, timbre,
        method = "mean"
      )
  ) |>
  mutate(pitches = map(pitches, compmus_normalise, "clr")) |>
  mutate_at(vars(pitches, timbre), map, bind_rows) |>
  unnest(cols = c(pitches, timbre))

# Assuming 'corpus433complete' is your dataset containing multiple versions of the same song
# Assuming you have a column named 'track.name' indicating the name of each track

# Create a new column for track numbers
corpus433complete$track_number <- 1

# Group the dataset by track.name and increment track_number within each group
corpus433complete <- within(corpus433complete, {
  track_number <- ave(track_number, track.name, FUN = seq_along)
})

# Add a new column with unique track names based on the track name and track number
# corpus433complete$unique_track_name <- paste0(corpus433complete$track.name, "_", corpus433complete$track_number)
corpus433complete$unique_track_name <- corpus433complete$track.uri

# Now you can proceed with creating 'corpus433complete_juice'
corpus433complete_juice <- recipe(
  unique_track_name ~
    danceability +
    energy +
    loudness +
    speechiness +
    acousticness +
    instrumentalness +
    liveness +
    valence +
    tempo +
    duration +
    C + `C#|Db` + D + `D#|Eb` +
    E + `F` + `F#|Gb` + G +
    `G#|Ab` + A + `A#|Bb` + B +
    c01 + c02 + c03 + c04 + c05 + c06 +
    c07 + c08 + c09 + c10 + c11 + c12,
  data = corpus433complete
) |>
step_center(all_predictors()) |>
step_scale(all_predictors()) |> 
prep() |>
juice() |>
column_to_rownames("unique_track_name")

#grower's manhattan is prettier
corpus433complete_dist <- dist(corpus433complete_juice, method = "manhattan")
```

### Hierarchical clustering week 12

```{r}
corpus433complete_dist |> 
  hclust(method = "single") |> # Try single, average, and complete.
  dendro_data() |>
  ggdendrogram()

corpus433complete_dist |> 
  hclust(method = "average") |> # Try single, average, and complete.
  dendro_data() |>
  ggdendrogram()

corpus433complete_dist |> 
  hclust(method = "complete") |> # Try single, average, and complete.
  dendro_data() |>
  ggdendrogram()
```

***
For my Portfolio, I am researching multiple versions of 4'33''. It is not possible to have a duplicate name in the code, that is why I had to change the code. What you are seeing now, are the URI's of the songs. Some versions has apparently different URI's, even though it is from the exact same album. Here is the URI and tracklist:

4’33’’ ‘URI’ on track order in my playlist:
1. 2bNCdW4rLnCTzgqUXTTDO1 4’33’’; John Cage (original)
2. 0lBcxdmI4HC47zEsRSKrty 4’33’’; Floraleda Sacchi
3. 647hR0e3Rp07l8MtPSMu2s 4’33’’; John Cage, Khatia Buniatishvili
4. 21UVJ8oU61i9anMWeihNaK 4’33’’; John Cage, Cláudio de Pina
5. 4rmfp2gYxSk5YrlCPVOdxc 4’33’’; Los Barenboim
6. 4HUPiqipTQrGEyINwBkws7 4’33’’; Lord Of The Lost
7. 1OLtteOhDml54bhUZ52R83 4’33’’; Simon Pfisterer
8. 4X0q9ZYvxys3SOZ5oRGfiI  4’33’’; Vítor Rua
9. 5ErWipeiIGzWbLiKm4IY3l 4’33’’:4’33; John Cage, Amadinda Percussion Group (2 URI’s, 1st one) 
10. 1SXr2VaU6bdVjzGx0BPixm 4’33’’; The Normal
11. 0hiBug8osiqLDdbz5G6YWc 4’ 33’’; John Cage, Julie Steinberg
12. 5B7HHrAsopOgp3wjP0PMgT 4’33’’ Cage Against the Machine Version; John Cage
13. 5r9yyfY10OtM7yduliCNGO 4’ 33’’; John Cage, Julie Steinberg, The Audience (3 different URI’s, 1st one)
14. 4F76YbFSTzXboAKhyypE7a 4.33; John Cage
15. 7ybfuJrKqm2BvdNa7HvZeV 4’33’’ (John Cage); John Cage, Enno Voorhorst
16. 258jYnAoeGhCkWJNPsLkZV 4’ 33’’; John Cage, Susanne Kessel
17. 50BjVN5UcKt5sfUIbKcphZ 4’33’’ (John Cage); John Cage, Michael Koehler
18. 2PNYl1F6FqTsXh8KfLVPar 4’ 33’’; John Cage, Julie Steinberg, The Audience (3 different URI’s, 2nd one)
19. 3zD4FdmDMZfn4lcLVihLvB 4’ 33’’; John Cage, Susanne Kessel 
20. 6igC1QpBYnJfXbAryAwl1H 4’ 33’’; John Cage, Julie Steinberg (3 different URI’s, 3rd one)
21. 3ihJwbgyRVF97On9HlRpHX 4.33; John Cage, Paata Beridze
22. 0YAS6w9qX25EtU4NzW1DUz 4’33’’:4’33’’ - I; John Cage, Ezio Bosso
23. 79UBz1H7T0DxomzwCuASow 4’33’’:4’33’’ - II; John Cage, Ezio Bosso
24. 1Y5v7QUdVgwkVdVP62QlFK 4’33’’:4’33’’ - III; John Cage, Ezio Bosso
25. 7wkeyVfZ1olD5VabaHvNu0 4’33’’: I. —; John Cage, Tobias Rüger, Reimar Volker, Ulrich Krieger
26. 1jlBp8wTbaw67jGaTmDFZ3  4’33’’: II. —; John Cage, Tobias Rüger, Reimar Volker, Ulrich Krieger
27. 1WzhWhNJXHIwptZvMzs9bh  4’33’’: III. —; John Cage, Tobias Rüger, Reimar Volker, Ulrich Krieger
28. 0SdGIygJRmHIseHmPGPEKg 4’33’’: I. —; John Cage, Tobias Rüger, Reimar Volker, Ulrich Krieger (other length, same name; other URI's)
29. 7tQdWcrHiUizkKAgGgmyew 4’33’’: II. —; John Cage, Tobias Rüger, Reimar Volker, Ulrich Krieger (other length, same name; other URI's)
30. 4kqeZgUPJE3M5QGjQJnl4Z 4’33’’: III. —; John Cage, Tobias Rüger, Reimar Volker, Ulrich Krieger (other length, same name; other URI's)
31. 7oY6XfEY0uZIzvniSnP3mi 4’33’’: I. —; John Cage, Tobias Rüger, Reimar Volker, Ulrich Krieger (same length as first one, same name, other songs; other URI's)
32. 65RoaBdRHcxPfESGUcxQkI 4’33’’: II. —; John Cage, Tobias Rüger, Reimar Volker, Ulrich Krieger (same length as first one, same name, other songs; other URI's)
33. 4J9yKjXnqFVNBQ5czUHQUB 4’33’’: III. —; John Cage, Tobias Rüger, Reimar Volker, Ulrich Krieger (same length as first one, same name, other songs; other URI's)
34. 3kKpPtoHcUvdVIKiKnuEeZ 4’33’’: I. —; John Cage, Tobias Rüger, Reimar Volker, Ulrich Krieger (same as ‘other length’, same name, other song; other URI's)
35. 5tEKAeircCx1qQscqKokDS 4’33’’: II. —; John Cage, Tobias Rüger, Reimar Volker, Ulrich Krieger (same as ‘other length’, same name, other song; other URI's)
36. 0tppfd8DLVgzzwX8hCaVoe 4’33’’: III. —; John Cage, Tobias Rüger, Reimar Volker, Ulrich Krieger (same as ‘other length’, same name, other song; other URI's)
37. 0AQRAsPtKDHCv369ktkp3x 4’33 - Adam F`S Club Mix - Cage Against The Machine Version; John Cage
38. 3jb5L9viOhEoYuVbfpvlhA 4’33 - Herve Tidies His Studio Mix - Cage Against The Machine; John Cage
39. 4JRtsjsSqunh2ILro1EAhH 4’33’ - Alex Metric Enters the Batcave Mix - Cage Against The Machine; John Cage
40. 0EOT1qmisxEi2MDJ6DaWHT Fake Blood`S Needle Drop Mix - Cage Against The Machine; John Cage
41. 0eBgJxMleTWezJZPciCqdO Aeroplane’s 5`33` Mix - Cage Against The Machine; John Cage
42. 52QLogPTXh3KJI7JwjG2vP 4’33 - Japanese Popstar Watch Family Guy on Mute Mix - Cage Against The Machine; John Cage
43. 18KH1UVb7HMWaesDkTsyhS Calm Before the Storm - Remix by Mr Scruff - Cage Against The Machine; John Cage
44. 2XeCgpnODCLZayjtUmPZcc 4’33 No. 2: 0’00’’; John Cage, Langham Research Centre
45. 0TBxRgdH4bmEfoFQurMCrU 433 (In tre parti: 30 / 223 / 140) (1952) - Instrumental; John Cage, Walter Marchetti, Gianni Emilio Simonetti
46. 5JF9OovVNaQWibrsNcVixy 4’ 33’’ for 2 pianos; John Cage, Gerardo Herrera-Benavides
47. 4JxtqYIeGkq5ZPUtQWeQyN 4:33 (A Tribute to John Cage); Nils Frahm
48. 1Y6ed0uUifbNh4ZUmXNSt2 4’ 33’’-1 Tacet; John Cage, Wayne Marshall
49. 2unAy6PPNuFzYLXTj8V2r4 4’ 33’’-I Tacet; John Cage, Wayne Marshall
50. 0am5yMtWZuu6hUahyDgx3K 4’33’’:4’33; John Cage, Amadinda Percussion Group (2 URI’s, 2nd one) 
51. 2bFtFA1xbOk1MWmHYJybGK 433 (In tre parti: 30 / 223 / 140) (1952) - Instrumental; John Cage, Walter Marchetti, Gianni Emilio Simonetti (other URI’s)
52. 3GkR4zJNN8vpDDU6b3mSXe 4’33’’ (Excerpt); John Cage, Stephanie McCallum
53. 2EDGPmjHG8aH6FPRIz5oHL 4 Minuten 33 Sekunden; John Cage, Florian Klaus Rumpf




### Heatmaps week 12


```{r}
#single
heatmaply(
  corpus433complete_juice,
  hclustfun = hclust,
  hclust_method = "single",  # Change for single, average, or complete linkage.
  dist_method = "euclidean"
)
#average
heatmaply(
  corpus433complete_juice,
  hclustfun = hclust,
  hclust_method = "average",  # Change for single, average, or complete linkage.
  dist_method = "euclidean"
)
#complete
heatmaply(
  corpus433complete_juice,
  hclustfun = hclust,
  hclust_method = "complete",  # Change for single, average, or complete linkage.
  dist_method = "euclidean"
)
```

***
It seems like that the 3 different techniques ended up making the same heatmap. I cannot really explain why. I think the dendogram does a better job explaining it to me. That is why I will use the dendogram.


### Novelty functions week 11 


```{r}
mapbjc1.0 <-
  get_tidy_audio_analysis("2bNCdW4rLnCTzgqUXTTDO1") |>
  select(segments) |>
  unnest(segments)

mapbjc1.0 |>
  mutate(loudness_max_time = start + loudness_max_time) |>
  arrange(loudness_max_time) |>
  mutate(delta_loudness = loudness_max - lag(loudness_max)) |>
  ggplot(aes(x = loudness_max_time, y = pmax(0, delta_loudness))) +
  geom_line() +
  xlim(0, 300) +
  theme_minimal() +
  labs(x = "Time (s)", y = "Novelty")

mapbjc1.0 |>
  mutate(pitches = map(pitches, compmus_normalise, "clr")) |>
  arrange(start) |>
  mutate(pitches = map2(pitches, lag(pitches), `-`)) |>
  slice(-1) |> 
  compmus_gather_chroma() |> 
  group_by(start, duration) |> 
  summarise(novelty = sum(log1p(pmax(value, 0)))) |> 
  ggplot(aes(x = start + duration / 2, y = novelty)) +
  geom_line() +
  xlim(0, 300) +
  theme_minimal() +
  labs(x = "Time (s)", y = "Novelty")

mapbjc1.0 |>
  arrange(start) |>
  mutate(timbre = map2(timbre, lag(timbre), `-`)) |>
  slice(-1) |>
  compmus_gather_timbre() |>
  group_by(start, duration) |> 
  summarise(novelty = sum(log1p(pmax(value, 0)))) |> 
  ggplot(aes(x = start + duration / 2, y = novelty)) +
  geom_line() +
  xlim(0, 300) +
  theme_minimal() +
  labs(x = "Time (s)", y = "Novelty")

mapbjc1.0 <- get_tidy_audio_analysis("2bNCdW4rLnCTzgqUXTTDO1")
```



### Tempogram week 11


```{r}
mapbjc1.0 |>
  tempogram(window_size = 8, hop_size = 1, cyclic = FALSE) |>
  ggplot(aes(x = time, y = bpm, fill = power)) +
  geom_raster() +
  scale_fill_viridis_c(guide = "none") +
  labs(x = "Time (s)", y = "Tempo (BPM)") +
  theme_classic()

mapbjc1.0|>
  tempogram(window_size = 8, hop_size = 1, cyclic = TRUE) |>
  ggplot(aes(x = time, y = bpm, fill = power)) +
  geom_raster() +
  scale_fill_viridis_c(guide = "none") +
  labs(x = "Time (s)", y = "Tempo (BPM)") +
  theme_classic()

```

***
All of these plot are 4'33'' of John Cage (the original version). The tempogram is also of the same song. It is interesting to see that Rstudios can see a tempo? Even though it is silence. Is there anyone who have an idea how this is


### Introduction

My corpus is in reversed order! I will fix this, after week 11.

Dear Reader,

For this project, I want to analyse different versions of the musical piece: 4'33'' by John Cage. 4'33'' is a piece made by John Cage. It is not my favourite song, but it questions perfectly what music is and what it can be. I am interested in which information I can get about the different versions, by analysing it with Rstudios. That is why I made a playlist with different versions of 4'33''. In 2010, John Cage released a new album with different versions of 4'33'' (he died in 1992, so I do not know whether he made it, but it is in his spotify). I will also use that playlist.

I also would like to compare this song with another extreme song or a genre which is the opposite, but I cannot think of a song or genre. If you know something, it would help me a lot!

Kind regards, Lucius Groot


### week 10
```{r}
# Function to create matched pitch plot
create_matched_pitch_plot <- function(track_id, chord_templates, key_templates, method = "euclidean", norm = "manhattan") {
  track_data <- get_tidy_audio_analysis(track_id)

  matched_pitch_data <- track_data |>
    compmus_align(bars, segments) |>
    select(bars) |>
    unnest(bars) |>
    mutate(
      pitches =
        map(segments,
            compmus_summarise, pitches,
            method = "mean", norm = "manhattan"
        )
    ) |> 
    compmus_match_pitch_template(chord_templates, method, norm)

  ggplot(matched_pitch_data,
    aes(x = start + duration / 2, width = duration, y = name, fill = d)
  ) +
  geom_tile() +
  scale_fill_viridis_c(guide = "none") +
  theme_minimal() +
  labs(x = "Time (s)", y = "")
}



create_matched_pitch_plot("2bNCdW4rLnCTzgqUXTTDO1", chord_templates, key_templates, method = "euclidean", norm = "manhattan") 
create_matched_pitch_plot("2bNCdW4rLnCTzgqUXTTDO1", chord_templates, key_templates, method = "euclidean", norm = "manhattan") 




```

***
This is of the 1st track in the made and played album, the original 4'33''. There is no musical sound, so it is weird that you can see al these dominant chords. If you know how I can change the scale/colours, let me know; I want the plot to be as realistic as possible.
I did not had enough time to put a story of what I did in the codes; because my portfolio decided to stop working; so I had to rewrite the whole document and I almost decided to drop this course, because 1 week went well with the homework so far.

```{r}

#Function to create matched pitch data and plot
create_mapbjc_pitch_match_plot <- function(track_data, key_templates, method = "euclidean", norm = "manhattan") {
  matched_pitch_data <- track_data |>
    compmus_match_pitch_template(
      key_templates,
      method = method,
      norm = norm
    )

  matched_pitch_data |>
    ggplot(
      aes(x = start + duration / 2, width = duration, y = name, fill = d)
    ) +
    geom_tile() +
    scale_fill_viridis_c(guide = "none") +
    theme_minimal() +
    labs(x = "Time (s)", y = "")
}

# Create and plot matched pitch data for mapbjc1 to mapbjc7
create_mapbjc_pitch_match_plot(mapbjc1, key_templates, method = "euclidean", norm = "manhattan")
create_mapbjc_pitch_match_plot(mapbjc2, key_templates, method = "euclidean", norm = "manhattan")
create_mapbjc_pitch_match_plot(mapbjc3, key_templates, method = "euclidean", norm = "manhattan")
create_mapbjc_pitch_match_plot(mapbjc4, key_templates, method = "euclidean", norm = "manhattan")
create_mapbjc_pitch_match_plot(mapbjc5, key_templates, method = "euclidean", norm = "manhattan")
create_mapbjc_pitch_match_plot(mapbjc6, key_templates, method = "euclidean", norm = "manhattan")
create_mapbjc_pitch_match_plot(mapbjc7, key_templates, method = "euclidean", norm = "manhattan")

create_mapbjc_pitch_match_plot(mapbjc10, key_templates, method = "euclidean", norm = "manhattan")

```

***
These are the 1st till 7th and 10th of the made and played track. No8 and No9 did not work. I do not know why.
Same story as the other one of these week.
If you know how I can make all the plot the same length and width, please let me know; I tried something and it did not work.



### week 9?

I do not know what happened, but my work after week 9 stopped with working and I am stressing right now.
```{r}
mapbjc1 |>
  compmus_self_similarity(timbre, "cosine") |> 
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  scale_fill_viridis_c(guide = "none") +
  theme_classic() +
  labs(x = "", y = "") + ggtitle("mapbjc track 1")

mapbjc2 |>
  compmus_self_similarity(timbre, "cosine") |> 
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  scale_fill_viridis_c(guide = "none") +
  theme_classic() +
  labs(x = "", y = "") + ggtitle("mapbjc track 2")

mapbjc3 |>
  compmus_self_similarity(timbre, "cosine") |> 
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  scale_fill_viridis_c(guide = "none") +
  theme_classic() +
  labs(x = "", y = "") + ggtitle("mapbjc track 3")

mapbjc4 |>
  compmus_self_similarity(timbre, "cosine") |> 
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  scale_fill_viridis_c(guide = "none") +
  theme_classic() +
  labs(x = "", y = "") + ggtitle("mapbjc track 4")

mapbjc5 |>
  compmus_self_similarity(timbre, "cosine") |> 
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  scale_fill_viridis_c(guide = "none") +
  theme_classic() +
  labs(x = "", y = "") + ggtitle("mapbjc track 5")

mapbjc6 |>
  compmus_self_similarity(timbre, "cosine") |> 
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  scale_fill_viridis_c(guide = "none") +
  theme_classic() +
  labs(x = "", y = "") + ggtitle("mapbjc track 6")

mapbjc7 |>
  compmus_self_similarity(timbre, "cosine") |> 
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  scale_fill_viridis_c(guide = "none") +
  theme_classic() +
  labs(x = "", y = "") + ggtitle("mapbjc track 7")


mapbjc10 |>
  compmus_self_similarity(timbre, "cosine") |> 
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  scale_fill_viridis_c(guide = "none") +
  theme_classic() +
  labs(x = "", y = "") + ggtitle("mapbjc track 10")

```

***
Here is my comparison for track 1 till 7 and 10 with a structure analysis of the playlist in which only John Cage is credited on Spotify.
1. Is the original, you can see that it exist out of 3 parts. Track 3 is the closest (if you follow the big lines) in form to track 1. The other tracks are just all over the place and some of them could be a total different piece.
Edit: Track No. 1 decided to disappear, so it is 2 till 7 and 10, i do not know how i should fix this. I FIXED IT, IT IS BACK!


### Week 9 sceptrogram

```{r}
# For mapbjc 1
mapbjc1 |>
  compmus_gather_timbre() |>
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = basis,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  scale_fill_viridis_c() +
  theme_classic() + ggtitle("mapbjc track 1")

# For mapbjc 2
mapbjc2 |>
  compmus_gather_timbre() |>
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = basis,
      fill = value 
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  scale_fill_viridis_c() +
  theme_classic() + ggtitle("mapbjc track 2")

# For mapbjc 3
mapbjc3 |>
  compmus_gather_timbre() |>
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = basis,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  scale_fill_viridis_c() +
  theme_classic() + ggtitle("mapbjc track 3") 

# For mapbjc 4
mapbjc4 |>
  compmus_gather_timbre() |>
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = basis,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  scale_fill_viridis_c() +
  theme_classic() + ggtitle("mapbjc track 4")

# For mapbjc 5
mapbjc5 |>
  compmus_gather_timbre() |>
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = basis,
      fill = value
    ) 
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  scale_fill_viridis_c() +
  theme_classic() + ggtitle("mapbjc track 5")
 
# For mapbjc 6
mapbjc6 |>
  compmus_gather_timbre() |>
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = basis,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  scale_fill_viridis_c() +
  theme_classic() + ggtitle("mapbjc track 6")

# For mapbjc 7
mapbjc7 |>
  compmus_gather_timbre() |>
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = basis,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  scale_fill_viridis_c() +
  theme_classic() + ggtitle("mapbjc track 8")



# For mapbjc 10
mapbjc10 |>
  compmus_gather_timbre() |>
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = basis,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  scale_fill_viridis_c() +
  theme_classic() + ggtitle("mapbjc track 10")

```

***
You can see very clear in mapbjc1 that there is a magnitude of 0 around c01. c02 has the highest magnitude overall. 

mapbjc track 2, 6, 10 and 4 in order of most to least have a similar magnitude aroung c02.
It is noticable tht there is a magnitude around c03 in track 3 and 7.
Track 5 could again be another piece.



### week 8
```{r}
##mapbjc track 1
mapbjc1 <-
  get_tidy_audio_analysis("2bNCdW4rLnCTzgqUXTTDO1") |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches) 

##mapbjc track 2
mapbjc2 <-
  get_tidy_audio_analysis("5B7HHrAsopOgp3wjP0PMgT") |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches) 

##mapbjc track 3
mapbjc3 <-
  get_tidy_audio_analysis("4F76YbFSTzXboAKhyypE7a") |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)


compmus_long_distance(
  mapbjc1 |> mutate(pitches = map(pitches, compmus_normalise, "chebyshev")),
  mapbjc2 |> mutate(pitches = map(pitches, compmus_normalise, "chebyshev")),
  feature = pitches,
  method = "euclidean"
) |>
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_equal() +
  labs(x = "mapbjc track 1", y = "mapbjc track 2") +
  theme_minimal() +
  scale_fill_viridis_c(guide = NULL)

compmus_long_distance(
  mapbjc1 |> mutate(pitches = map(pitches, compmus_normalise, "chebyshev")),
  mapbjc3 |> mutate(pitches = map(pitches, compmus_normalise, "chebyshev")),
  feature = pitches,
  method = "euclidean"
) |>
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_equal() +
  labs(x = "mapbjc track 2", y = "mapbjc track 3") +
  theme_minimal() +
  scale_fill_viridis_c(guide = NULL)

compmus_long_distance(
  mapbjc2 |> mutate(pitches = map(pitches, compmus_normalise, "chebyshev")),
  mapbjc3 |> mutate(pitches = map(pitches, compmus_normalise, "chebyshev")),
  feature = pitches,
  method = "euclidean"
) |>
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_equal() +
  labs(x = "mapbjc track 2", y = "mapbjc track 3") +
  theme_minimal() +
  scale_fill_viridis_c(guide = NULL)
```

### Week 8 part2

```{r}
create_map_plot <- function(data, track_number) {
  data %>%
    mutate(pitches = map(pitches, compmus_normalise, "euclidean")) %>%
    compmus_gather_chroma() %>%
    ggplot(
      aes(
        x = start + duration / 2,
        width = duration,
        y = pitch_class,
        fill = value
      )
    ) +
    geom_tile() +
    labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
    theme_minimal() +
    scale_fill_viridis_c() + 
    ggtitle(paste("mapbjc track", track_number))
}

# Example usage:
create_map_plot(mapbjc1, 1)
create_map_plot(mapbjc2, 2)
create_map_plot(mapbjc3, 3)
create_map_plot(mapbjc4, 4)
create_map_plot(mapbjc5, 5)
create_map_plot(mapbjc6, 6)
create_map_plot(mapbjc7, 7)

create_map_plot(mapbjc10, 10)




```


***
I do not know what I can conclude from the mapbjc tracks; but apparently every 4'33'' has its own key; while I cannot hear a key if I am listening.



### week 7
In week 7, I experiment with different codes. You can see what my results are in the following tabs:

### Summary of the lists

```{r}
#summary of "All I could find"
aic |>
  summarise(
    mean_speechiness = mean(speechiness),
    mean_acousticness = mean(acousticness),
    mean_liveness = mean(liveness),
    sd_speechiness = sd(speechiness),
    sd_acousticness = sd(acousticness),
    sd_liveness = sd(liveness),
    median_speechiness = median(speechiness),
    median_acousticness = median(acousticness),
    median_liveness = median(liveness),
    mad_speechiness = mad(speechiness),
    mad_acousticness = mad(acousticness),
    mad_liveness = mad(liveness)
  ) 

#summary of  "Made and performed"
mapbjc |>
  summarise(
    mean_speechiness = mean(speechiness),
    mean_acousticness = mean(acousticness),
    mean_liveness = mean(liveness),
    sd_speechiness = sd(speechiness),
    sd_acousticness = sd(acousticness),
    sd_liveness = sd(liveness),
    median_speechiness = median(speechiness),
    median_acousticness = median(acousticness),
    median_liveness = median(liveness),
    mad_speechiness = mad(speechiness),
    mad_acousticness = mad(acousticness),
    mad_liveness = mad(liveness)
  )

#summary of  "cover/interpration without credits"
nmopbjc |>
  summarise(
    mean_speechiness = mean(speechiness),
    mean_acousticness = mean(acousticness),
    mean_liveness = mean(liveness),
    sd_speechiness = sd(speechiness),
    sd_acousticness = sd(acousticness),
    sd_liveness = sd(liveness),
    median_speechiness = median(speechiness),
    median_acousticness = median(acousticness),
    median_liveness = median(liveness),
    mad_speechiness = mad(speechiness),
    mad_acousticness = mad(acousticness),
    mad_liveness = mad(liveness)
  )

#summary of  "Made not performed"
mbjcbnp |>
  summarise(
    mean_speechiness = mean(speechiness),
    mean_acousticness = mean(acousticness),
    mean_liveness = mean(liveness),
    sd_speechiness = sd(speechiness),
    sd_acousticness = sd(acousticness),
    sd_liveness = sd(liveness),
    median_speechiness = median(speechiness),
    median_acousticness = median(acousticness),
    median_liveness = median(liveness),
    mad_speechiness = mad(speechiness),
    mad_acousticness = mad(acousticness),
    mad_liveness = mad(liveness)
  )

#summary of  "10 versions of the same length"
cwtel |>
  summarise(
    mean_speechiness = mean(speechiness),
    mean_acousticness = mean(acousticness),
    mean_liveness = mean(liveness),
    sd_speechiness = sd(speechiness),
    sd_acousticness = sd(acousticness),
    sd_liveness = sd(liveness),
    median_speechiness = median(speechiness),
    median_acousticness = median(acousticness),
    median_liveness = median(liveness),
    mad_speechiness = mad(speechiness),
    mad_acousticness = mad(acousticness),
    mad_liveness = mad(liveness)
  )


#summary of  "10 versions"
sc |>
  summarise(
    mean_speechiness = mean(speechiness),
    mean_acousticness = mean(acousticness),
    mean_liveness = mean(liveness),
    sd_speechiness = sd(speechiness),
    sd_acousticness = sd(acousticness),
    sd_liveness = sd(liveness),
    median_speechiness = median(speechiness),
    median_acousticness = median(acousticness),
    median_liveness = median(liveness),
    mad_speechiness = mad(speechiness),
    mad_acousticness = mad(acousticness),
    mad_liveness = mad(liveness)
  )
```


***
The summary I let Rstudio made of my lists:
It is possible to make a summary of 4'33'', but not if there are too many songs in one playlist. 


  

### Valence/Energy/Mode

I want to know of both the lists:
Valence versus energy + the mode

```{r}
#The three lists combined
ggplot(aic, aes(valence, energy)) +
  geom_point(aes(colour= mode)) +
  scale_y_log10() +
   ggtitle("All I could find")

 
  #The plot of the different versions made and performed by John Cage
ggplot(mapbjc, aes(valence, energy)) +
  geom_point(aes(colour= mode)) +
  scale_y_log10() +
   ggtitle("Made and performed")

  #Plot of different covers
ggplot(nmopbjc, aes(valence, energy)) +
  geom_point(aes(colour= mode)) +
  scale_y_log10() +
   ggtitle("Covers/Interpretation without credits")

#Plot of version made but not played by John Cage
ggplot(mbjcbnp, aes(valence, energy)) +
  geom_point(aes(colour= mode)) +
  scale_y_log10() +
   ggtitle("Made but not played")

#Plot of the 10 version's 
ggplot(cwtel, aes(valence, energy)) +
  geom_point(aes(colour= mode)) +
  scale_y_log10() +
   ggtitle("Plot of 10 versions of the same length")

```

***
I will have to reconsider the setting of the plots.


### Valence/Energy/Mode in a smoothcurve


```{r}

  #the plots combined
sc |> ggplot(aes(x = valence, y = energy)) + geom_point() + geom_smooth() + 
  facet_wrap(~category) + 
  ggtitle("All I could find")
 
  #all I could find
aic |> ggplot(aes(x = valence, y = energy, color = mode)) + 
  geom_point() + 
  geom_smooth(span = 0.5) +  #idk what this does
  ggtitle("All I could find")

  #Made and performed
mapbjc |> ggplot(aes(x = valence, y = energy, color = mode)) + 
  geom_point() + 
  geom_smooth(span = 0.5) +  #idk what this does
  ggtitle("Made and performed")

  #Cover/Interpretation without credits
nmopbjc |> ggplot(aes(x = valence, y = energy)) + geom_point() + geom_smooth() +
    ggtitle("Cover/Interpretation without credits")

  #Made but not performed by John Cage
mbjcbnp |> ggplot(aes(x = valence, y = energy)) + geom_point() + geom_smooth() +
    ggtitle("Made but not performed")

#the plots individual: 10 versions
cwtel |> ggplot(aes(x = valence, y = energy)) + geom_point() + geom_smooth() +
    ggtitle("10 versions")



```

*** 
I want to know of both the lists:
How can there be a key? What makes that there are different energies and how can some be negative?


### The code of the homework week 7

```{r}

#making 4 plots next to each other
sc |>                    # Start with shortcut of all the playlists
  mutate(
    mode = ifelse(mode == 0, "Minor", "Major")
  ) |>
  ggplot(                     #This is the code I used for making the plot with ggplot2, i took inspiration from the assignment during the class
    aes(
      x = valence,
      y = energy,
      size = loudness,
      colour = mode
    )
  ) +
  geom_point() +              #first I tried to make a scatterplot
  geom_rug(linewidth = 0.1) + #deciding that the border is x
  geom_text(                  #valence versus energy labels
    aes(
      x = valence,
      y = energy,
      label = label
    ),
    data = 
      tibble(
        label = c("??", "??"),
        category = c("??", "??"),
        valence = c(0.104, 0.0339),
        energy = c(0.992, 0.00166)
      ),
    colour = "black",         #colour of the plot is black
    size = 4,                 ##i want the size of the plot to be 4
    hjust = "left",           #i was making left side
    vjust = "center",         #i was making right side
    nudge_x = 0.02            #i wanted to place the label slightly to the right
  ) +
  facet_wrap(~ category) +    #i decided that i wanted to use both my playlist in two plots in one, again
  scale_x_continuous(         #i decided to fine-tune the x axis
    limits = c(0, 1),
    breaks = c(0, 0.50, 1),  #i used grid-lines for quadrants only.
    minor_breaks = NULL       #i wanted to remove 'minor' grid-lines.
  ) +
  scale_y_continuous(        #i fine-tuned the y axis in the same way.
    limits = c(0, 1),
    breaks = c(0, 0.50, 1),
    minor_breaks = NULL
  ) +
  scale_colour_brewer(       #the color brewer i used for making a was palette
    type = "qual",            #i have a qualitative set
    palette = "Paired"        #i named the palette to 'Paired'
  ) +
  scale_size_continuous(      #i decided to also fine-tune the sizes of each point
    trans = "exp",            #i used an exp transformation to emphasise loud
    guide = "none"            #i remove the legend for size, did not need it
  ) +
  theme_light() +             #making the theme light
  labs(                       #Deciding the title
    x = "Valence",
    y = "Energy",
    colour = "Mode"
  )

```

***
I took some inspiration of the homework for my longest code ever



### Histogram of the lists
The histogram I made about both the lists:

```{r}

#histogram of everything i could find
sc |>
  ggplot(aes(x = energy)) +
  geom_histogram(binwidth = 0.005) +
  facet_wrap(~category) + ggtitle("4'33''")

aic |>
  ggplot(aes(x = energy)) +
  geom_histogram(binwidth = 0.005) + ggtitle("all i could find")

mapbjc |>
  ggplot(aes(x = energy)) +
  geom_histogram(binwidth = 0.005) + ggtitle("4'33''")

nmopbjc |>
  ggplot(aes(x = energy)) +
  geom_histogram(binwidth = 0.005) + ggtitle("4'33''")

mbjcbnp |>
  ggplot(aes(x = energy)) +
  geom_histogram(binwidth = 0.005) + ggtitle("4'33''")

cwtel |>
  ggplot(aes(x = energy)) +
  geom_histogram(binwidth = 0.005) + ggtitle("4'33''")
```

***
nothing special

```{r}

```

### conclusion
